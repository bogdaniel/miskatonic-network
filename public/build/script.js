"use strict";function parseUri(a){for(var b=parseUri.options,c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d}function replaceGet(a,b,c){var d=parseUri(a),e=[],f=!1;for(var g in d.queryKey)d.queryKey.hasOwnProperty(g)&&(g==b&&(d.queryKey[g]=c,f=!0),e.push(g+"="+d.queryKey[g]));if(f||e.push(b+"="+c),""===c){var h=e.indexOf(b+"="+c);h>=0&&e.splice(h,1)}return e.length&&(e=e.join("&"),e="?"+e),d.path+e}$(function(){function a(a,b){socket.emit("join",{username:a,room:b})}var b=parseUri(window.location.href),c="general";b.query&&(c=b.query),"/"==b.path&&a(username,c),$("form.chat").submit(function(a){a.preventDefault(),socket.emit("chatMessage",$("#m").val()),$("#m").val("")}),socket.on("userList",function(a){$(".chat-users").empty(),$.each(a,function(a,b){$(".chat-users").prepend($("<div>").text(b.username))})}),socket.on("archiveMessages",function(a){var b=$(".chat-messages");b.empty(),$.each(a,function(a,c){c=$.parseJSON(c),b.append($("<div>").text(c.username+", "+c.created_at+", "+c.message))}),b.scrollTop(b[0].scrollHeight)}),socket.on("chatMessage",function(a){var b=$(".chat-messages");b.append($("<div>").text(a.username+", "+a.created_at+", "+a.message)),b.scrollTop(b[0].scrollHeight)}),$("a.channel").on("click",function(b){b.preventDefault();var c=$(this).attr("href").substring(1);window.history.replaceState(null,null,"?"+c),$("a.channel").removeClass("active"),$(this).addClass("active"),a(username,c)})}),parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},$(function(){function a(a){var b=$('div.game[data-id="'+a.id+'"]');if(0===a.players.length&&b.length)return void b.remove();var c=$("<div>").addClass("game").attr("data-id",a.id),d=$("<div>").addClass("title").text(a.title),e=$("<div>").addClass("players"),f=$("<div>").addClass("player-1"),g=$("<div>").addClass("player-2"),h=$("<div>").append($("<button>").attr("id","join-game").text("Join"));a.players[0]?(f.text(a.players[0].username),$("#player-1").text(a.players[0].username)):$("#player-1").text(""),a.players[1]?(g.text(a.players[1].username),$("#player-2").text(a.players[1].username)):$("#player-2").text(""),(a.players[0].id==userId||2==a.players.length)&&h.hide(),e.append(f),e.append(g),c.append(d),c.append(e),c.append(h),c.append($("<hr>")),b.length?b.replaceWith(c):$("#game-list").prepend(c)}var b;$(document).on("mouseenter",".card-active, .card-exhausted, .card-story, .card-resource",function(){clearTimeout(b);var a=$(this).find("img").attr("src"),c=$("<img>").addClass("img-responsive").attr("src",a);$(".highlight").html(c)}).on("mouseout",".card-active, .card-exhausted, .card-story, .card-resource",function(){b=setTimeout(function(){$(".highlight img").fadeOut(400,function(){$(".highlight").empty()})},1e4)}),$(document).on("click",".highlight img",function(){var a=$(this).attr("src");console.log(a)}),$(document).on("click","#create-game",function(){socket.emit("onCreateGame",{title:$("#game-title").val(),allow_spectators:$("#allow_spectators").val()}),$("#panel-create-game").hide(),$("#panel-start-game").show()}),socket.on("afterCreateGame",function(b){var c=b.game;a(c)}),$(document).on("click","#leave-game",function(){socket.emit("onLeaveGame"),$("#panel-create-game").show(),$("#panel-start-game").hide()}),socket.on("afterLeaveGame",function(b){var c=b.game;a(c)}),$(document).on("click","#join-game",function(){socket.emit("onJoinGame",{id:$(this).closest("div.game").data("id")}),$("#panel-create-game").hide(),$("#panel-start-game").show()}),socket.on("afterJoinGame",function(b){var c=b.game;a(c)}),$(document).on("click","#start-game",function(){socket.emit("onStartGame")}),socket.on("afterStartGame",function(a){var b=a.game,c=$('div.game[data-id="'+b.id+'"]');c.remove(),(b.players[0].id==userId||b.players[1].id==userId)&&(window.location="/play")}),$(document).on("click",".row-player .draw-deck",function(){socket.emit("onCardDraw",{amount:1})}),socket.on("afterCardDraw",function(a){var b,c,d,e;if(a.userId==userId){b=$(".row-player .draw-deck .counter"),c=parseInt(b.text())-1,b.text(c);var f=$("<img>").addClass("img-responsive").attr("src","/images/cards/"+a.card.image),g=$("<div>").addClass("card-frame card-active");g.append(f),$(".row-hand").append(g)}else b=$(".row-enemy .draw-deck .counter"),d=$(".row-enemy .hand-deck .counter"),c=parseInt(b.text())-1,e=parseInt(d.text())+1,b.text(c),d.text(e)})});